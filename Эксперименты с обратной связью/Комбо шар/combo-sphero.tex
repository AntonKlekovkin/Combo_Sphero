\documentclass[10pt]{article}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{amsmath,amssymb,amscd, amsfonts,amsthm}
%\usepackage{cite}
\usepackage{graphicx}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
%\usepackage{rcdcom}
\graphicspath{{pictures/}}

\newcommand{\bs}{\boldsymbol}
\newcommand{\bV}{\bs V}
\newcommand{\bF}{\bs F}
\newcommand{\bOm}{\bs\Omega}
\newcommand{\bK}{\bs K}
\newcommand{\bQ}{\bs Q}
\newcommand{\bR}{\bs R}
\newcommand{\bN}{\bs N}
\newcommand{\bI}{\bs I}
\newcommand{\x}{\times}
\newcommand{\lm}{\lambda}
\newcommand{\Om}{\Omega}
\newcommand{\om}{\omega}
\newcommand{\q}{\quad}

\begin{document}

\bigskip
\begin{center}
{\Large \bf Управление комбинированным сферороботом с обратной связью}
\end{center}

\section{Введение}

\qquad На сегодняшний день существует большое количество работ, посвященных сферическим роботам. Подробные обзоры конструкций и принципов приведения в движение можно найти в работах \cite{OmniwheelSphero}. Наиболее популярными способами реализации движения сферических роботов являются изменение положения центра масс и изменение внутреннего гиростатического момента.

Теоретические исследования динамики сфероробота комбинированного типа, использующего для движения как смещение центра масс, так и изменение гиростатического момента, катящегося без проскальзывания по горизонтальной плоскости, проведены в работе \cite{ComboSpheroTheory}. В работе \cite{ComboSphero} были проведены экспериментальные исследования, была доказана возможность управления сферическим роботом комбинированного типа. При проведении экспериментов было отмечено, что введение в систему управления обратных связей позволит повысить эффективность управления и устойчивость движения. Теоретическое исследование модели управления сфероробота комбинированного типа с обратной связью, рассмотрена в работе \cite{}, также было проведено компьютерное моделирование движения, которое показало эффективность предложенной модели. В предлагаемом подходе обратная связь зависит от фазовых переменных (текущего положения, скоростей) и не зависит от конкретного вида траектории. В данной работе мы проведем экспериментальные исследования, на основе теоретических данных введем в систему управления обратные связи и покажем как это влияет на движение сфероробота.


\section{Экспериментальное исследование движения сфероробота с обратными связями}

\qquad Краткое описание работы Лены. В работе \cite{} рассмотерно управление сфероробтом комбинированного типа с обратной связью для движения по ... (вдоль...). Что-то еще.

Рассмотрим уравнения определяющие обратную связь \cite{} для реализации движения вдоль прямой (?) в виде управляющих моментов $K_{\vartheta}$ и $K_{\varphi}$

\begin{equation}
K_{\vartheta} = \tilde{k_{\vartheta}}(\dot{\vartheta} + \frac{v^*}{R_s}), \quad
K_{\varphi} = \tilde{k_{\varphi}}(\bOm, e_2+e_3).
\label{torque_wheels}
\end{equation}

где $\tilde{k}_{\vartheta}, \tilde{k}_{\varphi}$ -- постоянные коэффициенты, $\vartheta$ -- угол поворота маятника вокруг оси $e_1$ в подвижной системе координат,
%$\varphi$ -- угол поворота ротора вокруг оси $e_3$ в подвижной системе координат,
$R_s$ -- радиус сферической оболочки, $v^*$ -- заданное значение линейной скорости качения сфероробота после стабилизации движения, $\bOm$ -- угловая скорость вращения оболочки.

Результаты моделирования движения сфероробота комбинированного типа приведенные в \cite{} с учетом обратной связи (\ref{torque_wheels}) подтверждают возможность стабилизации сфероробота, однако, вопрос выбора и обоснования коэффициентов регуляторов $\tilde{k}_{\vartheta}$ и  $\tilde{k}_{\varphi}$ остались не раскрытыми. На практике, определение значений указанных коэффициентов имеет ключевое значение.

Проведем исследование предложенного алгоритма стабилизации сфероробота комбинированного типадля реальной модели сфероробота, разработанного в лаборатории Нелинейного анализа и новых средств передвижения УдГУ (см. работы \cite{}). Фото лабораторной модели сфероробота комбинированного типа, представленно на рисунке \ref{sphero}.

\begin{figure}[!h]
\centering\includegraphics[width=0.3\linewidth]{sphero.eps}
\caption{Лабораторная модель сфероробота комбинированного типа.\label{sphero}}
\end{figure}

Данная модель сфероробота комбинированного типа приводится в движение колесной тележкой, перемещающейся в экваториальной плоскости сферической оболочки $R_s=0.15$ м по ободу, имеющему специальный профиль. На колесной тележке расположен ротор так, что его ось вращения направлена вдоль радиуса сферической оболочки. Вращение ротора используется для поворота сферического робота. Каждое колесо приводится в движение отдельным двигателем постоянного тока, а для синхронизации скоростей используются датчики угла поворота колес, установленные на выходных валах приводных двигателей. 

%\begin{table}[!h]
%\caption{Основные характеристики сферического робота}
%\label{table1}
%\begin{center}
%\begin{tabular}{|c|c|c|}
%\hline
%Характеристика & Обозначение & Значение \\
%\hline
%Радиус сферы: & $R_s$ & $0.15$ м\\
%Масса сферы: & $m_s$ & $1.625$ кг \\
%Тензор инерции сферы: & $\bI_s$ & $diag(25.27\cdot10^{-3}, 20.73\cdot10^{-3}, 25.27\cdot10^{-3})$ кг$\cdot$м$^2$ \\
%Радиус ротора: & $R_r$ & $0.087$ м\\
%Масса ротора: & $m_r$ & $2.46$ кг\\
%Осевой момент инерции ротора: & $I_r$ & $5.64\cdot10^{-3}$ кг$\cdot$м$^2$ \\
%Масса тележки с ротором: & $m_b$ & $3.25$ кг\\
%Тензор инерции тележки с ротором: & $\bI_b$ & $diag(31.88\cdot10^{-3}, 30.59\cdot10^{-3}, 8.76\cdot10^{-3})$ кг$\cdot$м$^2$ \\
%\hline
%\end{tabular}
%\end{center}
%\end{table}

Для вращения роликов и ротора используются двигатели постоянного тока с редукторами~\cite{Pololu}. 

Стабилизация движения сфероробота комбинированного типа в соотвествии в выражениями (\ref{torque_wheels}) предполагает управление кинетическими моментами $K_{\vartheta}$ и $K_{\varphi}$ соответствующих приводов. Техническое управление моментами осуществляется по измеряемому току в двигателях, так как $K=c\cdot i$, где $c=0.003???$

Структурная схема регуляторов для стабилизации движения сфероробота приведена на рисунке~\ref{pid}. На схеме изображена система двухконтурного регулирования. Внешний контур отвечает за регулирование угловых скоростей сфероробота, на выходе которого получаем величину момента, которую необходимо поддерживать. Внутренний контур обеспечивает регулирование тока, а соответственно и величину момента на валу каждого из двигателей на заданном уровне.

\begin{figure}[!h]
\centering\includegraphics[width=0.8\linewidth]{pid.eps}
\caption{Схема регуляторов стабилизации движения сфероробота.\label{pid}}
\end{figure}

Для измерения тока используется датчик ACS712 -- линейный датчик тока на базе эффекта Холла. Измерения тока проводятся с частотой 20 КГц, после чего вычисляется среднее значение для 50 измерений из-за существенных пульсаций, характерных электрическим машинам. Для поддержания заданного значения тока реализован регулятор, пропорциональный величене отклонения реального значения величины тока от заданной.

Для измерения угловых скоростей сфероробота используется датчик MPU9250 -- миниатюрный девятиосевой сенсор движения компании InvenSense, который содержит 3-х осевой гироскоп, 3-х осевой акселерометр и 3-х осевой магнитометр. Измерения производятся с частотой 50 Гц, на этой же частоте работает внешний контур системы регулирования. Уравнения (\ref{torque_wheels}) предполагают линейную зависимость необходимых моментов от отклонения фазовых переменных, что на практике возможно реализовать только на конечном интервале из-за ограниченности кинематического момента, который могут обеспечить двигатели постоянного тока. Удобнее записать уравнения (\ref{torque_wheels}) в следующем виде

\begin{equation}
K_{\vartheta} = \frac{2 K_{max}}{\pi}arctg((\dot{\vartheta}+\frac{v^*}{R_s})\zeta_{\vartheta}), \quad
K_{\varphi} = \frac{2 K_{max}}{\pi}arctg((\bOm, e_2+e_3)\zeta_{\varphi}).
\label{torque_wheels2}
\end{equation}

где $\zeta_{\vartheta}, \zeta_{\varphi}$ -- коэффициенты наклона графика, $K_{max}$ -- максимальный ток, обеспечивающий максимальный момент двигателя. Для выбранного типа двигателей максимальный ток ограничим значением 1000 мА.

\subsection{Определение коэффициентов регулирования}

\qquad Для исключения взаимного влияния контуров обратной связи, рассмотрим определение коэффициентов $\zeta_{\vartheta}$ и $\zeta_{\varphi}$ по отдельности.

\begin{enumerate}
\item Рассмотрим движение сфероробота по прямолинейной траектории с небольшим препятствием (см. рисунок \ref{barrier}), преодолевая которое, сфероробот начинает совершать колебания в плоскости, параллельной направлению движения.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{barrier.eps}
\caption{Препятствие на пути движения робота.\label{barrier}}
\end{figure}

Препятствие представляет собой ступеньку высотой в 5 мм и длиной 600 мм. В данных экспериментах рассмотрено только уравнение момента $K_{\vartheta}$, так как раскачивание сфероробота происходит по ходу движения.

Для определения траектории движения сфероробота использовалась система захвата движения Vicon Motion Capture, которая позволяет получать зависимость от времени как координат, так и ориентации объекта.

Для определения оптимального коэффициента $\zeta_{\vartheta}$ проведено несколько серий экспериментов, при различных значениях $\zeta_{\vartheta}$ в интервале от $[1,4]$. Анализ экспериментов проводился по вертикальной компоненте вектора $\gamma_3$. Оптимальному значению коэффициента $\zeta_{\vartheta}$ соответствует минимум отклонения вертикальной компоненты вектора $\gamma_3$ от 1 (так как $\gamma_3=1$ -- целевое состояние, для которого определялись уравнения (\ref{torque_wheels})). Запишем уравнение среднего отклонения

\begin{equation}
\sigma=\sum_{j=1}^N \sqrt{\frac{\sum\limits_{i=1}^n(\gamma_{3_i}^j -1)^2}{n-1}} \cdot \frac{1}{N},
\label{sigma}
\end{equation}

где $n$ -- количество точек полученных при захвате траектории движения для одного эксперимента, $N$ -- количество экспериментов в серии, $j$ -- номер эксперимента.

На рисунке \ref{zeta} показана зависимость среднего отклонения $\sigma$ от значения коэффициента $\zeta_{\vartheta}$.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{zeta.eps}
\caption{Зависимость среднего отклонения $\left<\sigma\right>_{av}$ от значения коэффициента $\zeta_{\vartheta}$.\label{zeta}}
\end{figure}

Можно сделать вывод, что оптимальным является значение $\zeta_{\vartheta}=2$.

Далее проведены 3 эксперимента для движения с обратной связью и 3 эксперимента для движения без обратной связи. В экспериментах с обратной связью для расчета управляющих моментов (\ref{torque_wheels2}) использовались следующие значения параметров: $\zeta_{\vartheta}=2, \zeta_{\varphi}=0, v^*=0.3$ м/с. В экспериментах без обратной связи: $\zeta_{\vartheta}=0, \zeta_{\varphi}=0, v^*=0.3$ м/с.

%Графики, отображающие проекции вектора $e_3$ на ось $Z$ в неподвижной системе координат для трех экспериментов движения сфероробота с обратной связью показаны на рисунке \ref{exp1}а, аналогичные графики для экспериментов без обратной связи -- на рисунке \ref{exp1}б.

%\begin{figure}[h]
%\begin{minipage}[h]{0.49\linewidth}
%\center{\includegraphics[width=0.9\linewidth]{exp1_withFB.eps} \\ а)}
%\end{minipage}
%\hfill
%\begin{minipage}[h]{0.49\linewidth}
%\center{\includegraphics[width=0.9\linewidth]{exp1_withoutFB.eps} \\ б)}
%\end{minipage}
%\caption{Проекции вектора $e_3$ на ось $Z$ для экспериментов с обратной связью (а) и без (б)}
%\label{exp1}
%\end{figure}

Для сравнения, на рисунке \ref{feedback_line} показаны графики, отображающие проекцию компоненты $\gamma_3$ для одного из экспериментов движения сфероробота с обратной связью и одного из экспериментов движения сфероробота без обратной связи.

\begin{figure}[!h]
\centering\includegraphics[width=1\linewidth]{feedback_line.eps}
\caption{Проекции компоненты $\gamma_3$. Сравнение эксперимента с обратной связью и без обратной связи.\label{feedback_line}}
\end{figure}

Сравним среднее отклонение проекции $\gamma_3$ от 1 для трех экспериментов с обратной связью  и без нее, расчитанное по уравнению (\ref{sigma}). Для экспериментов с обратной связью $\sigma=0.025$, а для экспериментов без обратной связи $\sigma=0.078$. Это показывает, что движение с обратной связью более устойчивое, чем без нее.

\item Рассмотрим движение сфероробота по прямолинейной траектории с небольшим препятствием (рисунок \ref{barrier2}), преодолевая которое, сфероробот начинает совершать колебания в плоскостях, параллельной и перпендикулярной направлению движения.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{barrier2.eps}
\caption{Препятствие на пути движения робота.\label{barrier2}}
\end{figure}

Цель данных экспериментов -- определить оптимальное значение коэффициента $\zeta_{\varphi}$. Для этого было проведено несколько серий экспериментов, в которых значение момента на колесах тележки сфероробота устанавливалось постоянным $K_{\vartheta}=const$, а коэффициент $\zeta_{\varphi}$ изменялся в интервале от $[0.1, 0.3]$. Анализ экспериментов проводился по вертикальной компоненте вектора $\gamma_3$ и горизонтальной компоненте вектора $\alpha_1$. Аналогично первой серии экспериментов оптимальному значению коэффициента $\zeta_{\varphi}$ соответствует минимум отклонения как вертикальной компоненты вектора $\gamma_3$, так и горизонтальной компоненты вектора $\alpha_1$ от 1. Среднее отклонение для каждого из векторов расчитывалось по (\ref{sigma}). На рисунке \ref{zeta_phi} показаны зависимости коэффициента $\zeta_{\varphi}$ от отклонений робота.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{zeta_phi.eps}
\caption{Зависимость коэффициента $\zeta_{\varphi}$ от отклонений робота.\label{zeta_phi}}
\end{figure}

Проанализировав полученные результаты, принимаем оптимальное значение коэффициента $\zeta_{\varphi}=0.15$.

Далее проведены 3 эксперимента для движения с обратной связью и 3 эксперимента для движения без обратной связи. В экспериментах с обратной связью для расчета управляющих моментов (\ref{torque_wheels2}) использовались следующие значения параметров: $\zeta_{\vartheta}=0, \zeta_{\varphi}=0.15, v^*=0.3$ м/с. В экспериментах без обратной связи: $\zeta_{\vartheta}=0, \zeta_{\varphi}=0, v^*=0.3$ м/с.

Для сравнения, на рисунке \ref{compare_angle}а показаны графики, отображающие проекцию $\gamma_3$ для одного из экспериментов движения сфероробота с обратной связью и одного из экспериментов движения сфероробота без обратной связи, а на рисунке \ref{compare_angle}б -- графики проекций $\alpha_1$.

\begin{figure}[h]
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.9\linewidth]{compareGamma.eps} \\ а)}
\end{minipage}
\hfill
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.9\linewidth]{compareAlpha.eps} \\ б)}
\end{minipage}
\caption{Проекции векторов $\gamma_3$ (а) и $\alpha_1$ (б) для экспериментов с обратной связью (зеленая линия) и без (красная линия)}
\label{compare_angle}
\end{figure}

Сравним среднее отклонение проекций $\gamma_3$ и $\alpha_1$ от 1 для трех экспериментов с обратной связью и без нее, расчитанное по уравнению (\ref{sigma}). Для экспериментов с обратной связью $\sigma_{\gamma_3}=0.136$, $\sigma_{\alpha_1}=0.033$; а для экспериментов без обратной связи $\sigma_{\gamma_3}=0.242$, $\sigma_{\alpha_1}=0.097$. Что также показывает, что движение с рассмотренным видом обратной связи более устойчивое.

\end{enumerate}

Получив оптимальные значения коэффициентов регулирования $\zeta_{\vartheta}$ и $\zeta_{\varphi}$ проведем эксперименты, используя эти значения в совокупности, и сравним движение сфероробота с регулятором и без него.



\section{Сравнение движений с обратной связью и без нее}

\qquad Рассмотрим движение робота по прямой, аналогичное движению в экспериментах по определению оптимального коэффициента $\zeta_{\varphi}$. Для расчета управляющих моментов (\ref{torque_wheels2}) использовались следующие значения параметров: $\zeta_{\vartheta}=2, \zeta_{\varphi}=0.15, v^*=0.3$ м/с. В экспериментах без обратной связи: $\zeta_{\vartheta}=0, \zeta_{\varphi}=0, v^*=0.3$ м/с. Проведем по пять экспериментов для каждого из вариантов. Для сравнения, на рисунке \ref{feedback_general}а показаны графики, отображающие проекцию $\gamma_3$ для одного из экспериментов движения сфероробота с обратной связью и одного из экспериментов движения сфероробота без обратной связи, а на рисунке \ref{feedback_general}б -- графики проекций $\alpha_1$.

\begin{figure}[h]
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.9\linewidth]{generalGamma.eps} \\ а)}
\end{minipage}
\hfill
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.9\linewidth]{generalAlpha.eps} \\ б)}
\end{minipage}
\caption{Проекции векторов $\gamma_3$ (а) и $\alpha_1$ (б) для экспериментов с обратной связью (розовая линия) и без (серая линия)}
\label{feedback_general}
\end{figure}

Сравним среднее отклонение проекций $\gamma_3$ и $\alpha_1$ от 1 для трех экспериментов с обратной связью и без нее, расчитанное по уравнению (\ref{sigma}). Для экспериментов с обратной связью $\sigma_{\gamma_3}=0.042$, $\sigma_{\alpha_1}=0.031$; а для экспериментов без обратной связи $\sigma_{\gamma_3}=0.076$, $\sigma_{\alpha_1}=0.179$. Что подтверждает, что движение с рассмотренным видом обратной связи более устойчивое, чем без нее.

%В экспериментах на последнем видео $\tilde{k_{\vartheta}}=100$. По идее от него должна зависеть линейная скорость, но она зависит еще от чего-то, может от заряда батареи, может еще от чего. В разные дни старался выбирать этот коэффициент таким, чтобы двигаться с одной скоростью (на глаз), он был равен от 60 до 100. $\dot{\vartheta}$ -- это угловая скорость тележки. Ее я считаю с энкодера одного из колес, перевожу в рад/с и умножаю на коэффициент $\frac{R_{wheel}}{R_{sphero\_internal}}=\frac{18}{145}=0.124138$, и в формуле беру ее со знаком минус. Выражение $\frac{v^*}{R_S}$ заменяю одним числом, в экспериментах на видео оно было равно 10. В итоге в моей программе уравнение момента принимает следующий вид:

%\begin{equation}
%K_{\vartheta} = \tilde{k_{\vartheta}}(-\dot{\vartheta} + v^*)=100(-\dot{\vartheta}+10),
%\label{torque_wheels_code}
%\end{equation}

%При расчете момента ротора второе уравнение (\ref{torque_wheels}) принимает вид:

%\begin{equation}
%K_{\varphi} = \tilde{k_{\varphi}}(\omega_2 - \dot{\vartheta} + \omega_3 - 0.1*\dot{\varphi}).
%\label{torque_wheels_code}
%\end{equation}

%Здесь я ввел еще один коэффициент 0.1 перед угловой скоростью ротора, так как она давала намного больший вклад. Здесь $\tilde{k_{\varphi}}=200$, $\omega_2$ и $\omega_3$ это компоненты  угловой скорости измеренные с помощью MPU9250 по соответсвующим осям: $\omega_2$ -- угловая скорость относительно оси, вдоль которой производится движение, $\omega_3$ -- угловая скорость относительно оси $Z$. $\dot{\vartheta}$ -- это угловая скорость колеса, считается по энкодеру и переводится в рад/с. Аналогично $\dot{\varphi}$ -- угловая скорость ротора, считается по энкодеру и переводится в рад/с. Угловую скорость колес $\dot{\vartheta}$ я не учитываю, так как это приводит к равномерному вращению ротора, поэтому в расчете момента $K_{\varphi}$ значение $\dot{\vartheta}=0$.

%Далее полученные моменты без коэффициентов устанавливают заданный ток на каждый двигатель. К этому значению тока двигатель выходит с помощью П регулятора. На регуляторах и колес, и ротора пропорциональный коэффициент равен 0.01, коэффициенты дифференциальной и интегральной составляющих равны 0.

%Измерения тока проводятся с частотой 20 КГц, для каждого двигателя берется среднее значение из 50 измерений. Далее это значение тока подается на вход соответствующего П регулятора, на выходе получаем изменение скважности ШИМ сигнала. Таки образом регулятор работает на частоте 400 Гц. Обновление заданого момента на двигателях происходит с частотой 50 Гц.

\begin{thebibliography}{99}

\bibitem{OmniwheelSphero}
Karavaev Y. L., Kilin A. A., The Dynamics and Control of a Spherical Robot with an Internal Omniwheel Platform, Regular and Chaotic Dynamics, 2015, vol. 20, no. 2, pp. 134-152

\bibitem{ComboSphero}
Килин А. А., Караваев Ю. Л., Экспериментальные исследования динамики сферического робота комбинированного типа, Нелинейная динамика, 2015, т. 11, \No 4, с. 721-734

\bibitem{ComboSpheroTheory}
Kilin A.A., Pivovarova E.N., Ivanova T.B. Spherical robot of combined type: Dynamics and control // Regul. Chaotic Dyn., 2015, vol.20, no.6, pp.716-728.

\bibitem{Pololu}
Pololu Robotics'n'Electronics [Электронный ресурс] // URL: https://www.pololu.com/product/1443/faqs

\end{thebibliography}

\end{document} 