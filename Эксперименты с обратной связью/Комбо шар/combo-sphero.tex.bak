\documentclass[10pt]{article}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{amsmath,amssymb,amscd, amsfonts,amsthm}
%\usepackage{cite}
\usepackage{graphicx}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
%\usepackage{rcdcom}
\graphicspath{{pictures/}}

\newcommand{\bs}{\boldsymbol}
\newcommand{\bV}{\bs V}
\newcommand{\bF}{\bs F}
\newcommand{\bOm}{\bs\Omega}
\newcommand{\bK}{\bs K}
\newcommand{\bQ}{\bs Q}
\newcommand{\bR}{\bs R}
\newcommand{\bN}{\bs N}
\newcommand{\x}{\times}
\newcommand{\lm}{\lambda}
\newcommand{\Om}{\Omega}
\newcommand{\om}{\omega}
\newcommand{\q}{\quad}

\begin{document}

\bigskip
\begin{center}
{\Large \bf Управление комбинированным сферороботом с обратной связью}
\end{center}

\section{Введение}

\qquad На сегодняшний день существует большое количество работ, посвященных сферическим роботам. Подробные обзоры конструкций и принципов приведения в движение можно найти в работах \cite{OmniwheelSphero}. Наиболее популярными способами реализации движения сферических роботов являются изменение положения центра масс и изменение внутреннего гиростатического момента.

Теоретические исследования динамики сфероробота комбинированного типа, использующего для движения как смещение центра масс, так и изменение гиростатического момента, катящегося без проскальзывания по горизонтальной плоскости, проведены в работе \cite{ComboSpheroTheory}. В работе \cite{ComboSphero} были проведены экспериментальные исследования, была доказана возможность управления сферическим роботом комбинированного типа. При проведении экспериментов было отмечено, что введение в систему управления обратных связей позволит повысить эффективность управления и устойчивость движения. Теоретическое исследование модели управления сфероробота комбинированного типа с обратной связью, рассмотрена в работе \cite{}, также было проведено компьютерное моделирование движения, которое показало эффективность предложенной модели. В предлагаемом подходе обратная связь зависит от фазовых переменных (текущего положения, скоростей) и не зависит от конкретного вида траектории. В данной работе мы проведем экспериментальные исследования, на основе теоретических данных введем в систему управления обратные связи и покажем как это влияет на движение сфероробота.


\section{Экспериментальное исследование движения сфероробота с обратными связями}

\qquad  Рассмотрим уравнения определяющие обратную связь в виде управляющих моментов $K_{\vartheta}$ и $K_{\varphi}$

\begin{equation}
K_{\vartheta} = \tilde{k_{\vartheta}}(\dot{\vartheta} + \frac{v^*}{R_s}), \quad
K_{\varphi} = \tilde{k_{\varphi}}(\bOm, e_2+e_3).
\label{torque_wheels}
\end{equation}

где $\tilde{k_{\vartheta}}, \tilde{k_{\varphi}}$ -- постоянные коэффициенты, $\vartheta$ -- угол поворота маятника вокруг оси $e_1$ в подвижной системе координат,
%$\varphi$ -- угол поворота ротора вокруг оси $e_3$ в подвижной системе координат,
$R_s$ -- радиус сферической оболочки, $v^*$ -- заданное значение линейной скорости качения сфероробота после стабилизации движения, $\bOm$ -- угловая скорость вращения оболочки.

\subsection{Особенности управления моментом на практике}

\qquad Для проведения экспериментальных исследований используется лабораторная модель сфероробота комбинированного типа, представленная на рисунке \ref{sphero}. Радиус сфероробота $R_s=0.15$ м.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{sphero.eps}
\caption{Лабораторная модель сфероробота комбинированного типа.\label{sphero}}
\end{figure}

Для вращения роликов и ротора используются двигатели постоянного тока фирмы Pololu, у этого типа двигателей момент на валу двигателя прямо пропорционален току, протекающему через обмотки двигателя~\cite{Pololu} (рисунок \ref{current-torque}). Поэтому для определения величины момента достаточно знать величину тока, протекающего через обмотки.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{current-torque.eps}
\caption{Зависимость характеристик двигателя.\label{current-torque}}
\end{figure}

Для измерения тока используется датчик ACS712 -- линейный датчик тока на базе эффекта Холла. На выходе датчика имеем аналоговый сигнал пропорциональный силе тока. Измерения тока проводятся с частотой 20 КГц, для каждого двигателя берется среднее значение из 50 измерений. Для поддержания заданного значения тока реализован П-регулятор для каждого двигателя. Следует отметить, что непосредственный переход значений тока к моментам не производится, так как эта зависимость заложена в коэффициенты регуляторов.

Таким образом уравнения (\ref{torque_wheels}) определяют входное значение П-регуляторов, но данные уравнения предполагают линейную зависимость необходимых моментов от отклонения фазовых переменных. В действительности же мы ограничены максимальным моментом двигателя, приводящего в движения тот или иной компонент сфероробота, при котором через двигатель протекает максимальный ток. Поэтому перепишем уравнения (\ref{torque_wheels}) в следующем виде

\begin{equation}
K_{\vartheta} = \frac{2 K_{max}}{\pi}arctg((\dot{\vartheta}+\frac{v^*}{R_s})\zeta_{\vartheta}), \quad
K_{\varphi} = \frac{2 K_{max}}{\pi}arctg((\bOm, e_2+e_3)\zeta_{\varphi}).
\label{torque_wheels2}
\end{equation}

где $\zeta_{\vartheta}, \zeta_{\varphi}$ -- коэффициенты наклона графика, $K_{max}$ -- максимальный ток, обеспечивающий максимальный момент двигателя. $K_{max}$ можно определить заблокировав вал двигателя и измерить значение тока. Для двигателей, установленных на нашей модели сфероробота максимальный ток равен приблизительно 1100 мА. Но в таком режиме двигатель находится в нерекомендуемом режиме работы, поэтому установим $K_{max}=1000$ мА.

\subsection{Движение по прямой}

\qquad Рассмотрим движение сфероробота по прямолинейной траектории с небольшим препятствием (рисунок \ref{barrier}), преодолевая которое, сфероробот начинает раскачиваться. 

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{barrier.eps}
\caption{Зависимость характеристик двигателя.\label{barrier}}
\end{figure}

Препятствие представляет собой ступеньку высотой в 5 мм и длиной 600 мм. В данных экспериментах рассмотрено только уравнение момента $K_{\vartheta}$, так как раскачивание сфероробота происходит по ходу движения. 

Для определения траектории движения сфероробота использовалась система захвата движения Vicon Motion Capture, которая позволяет получать зависимость от времени как координат, так и ориентации объекта.

Чтобы найти оптимальный коэффициент $\zeta_{\vartheta}$ проведено несколько серий экспериментов, в которых использовались различные значения $\zeta_{\vartheta}$ в интервале от $[1,4]$. Анализ экспериментов проводился по проекции вектора $e_3$ на ось $Z$ в неподвижной системе координат, определялось среднее отклонение проекции от 1

\begin{equation}
\left<\sigma\right>_{av}=\sum_{j=1}^N \sqrt{\frac{\sum\limits_{i=1}^n(e_3^Z -1)^2}{n-1}} \cdot \frac{1}{N},
\label{sigma}
\end{equation}

где $n$ -- количество точек полученных при захвате траектории движения для одного эксперимента, $N$ -- количество экспериментов в серии.

На рисунке \ref{zeta} показана зависимость среднего отклонения $\left<\sigma\right>_{av}$ от значения коэффициента $\zeta_{\vartheta}$.

\begin{figure}[!h]
\centering\includegraphics[width=0.5\linewidth]{zeta.eps}
\caption{Зависимость среднего отклонения $\left<\sigma\right>_{av}$ от значения коэффициента $\zeta_{\vartheta}$.\label{zeta}}
\end{figure}

Можно сделать вывод, что оптимальным является значение $\zeta_{\vartheta}=2$.

Далее проведены 3 эксперимента для движения с обратной связью и 3 эксперимента для движения без обратной связи. В экспериментах с обратной связью для расчета управляющих моментов (\ref{torque_wheels}) использовались следующие значения параметров: $\zeta_{\vartheta}=2, \zeta_{\varphi}=0, v^*=0.3$ м/с. В экспериментах без обратной связи: $\zeta_{\vartheta}=0, \zeta_{\varphi}=0, v^*=0.3$ м/с.

Графики, отображающие проекции вектора $e_3$ на ось $Z$ в неподвижной системе координат для трех экспериментов движения сфероробота с обратной связью показаны на рисунке \ref{exp1}а, аналогичные графики для экспериментов без обратной связи -- на рисунке \ref{exp1}б.

\begin{figure}[h]
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.9\linewidth]{exp1_withFB.eps} \\ а)}
\end{minipage}
\hfill
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.9\linewidth]{exp1_withoutFB.eps} \\ б)}
\end{minipage}
\caption{Проекции вектора $e_3$ на ось $Z$ для экспериментов с обратной связью (а) и без (б)}
\label{exp1}
\end{figure}

Для сравнения, на рисунке \ref{feedback_line} показаны графики, отображающие проекцию вектора $e_3$ на ось $Z$ в неподвижной системе координат для одного из экспериментов движения сфероробота с обратной связью и одного из экспериментов движения сфероробота без обратной связи.

\begin{figure}[!h]
\centering\includegraphics[width=1\linewidth]{feedback_line.eps}
\caption{Проекции вектора $e_3$ на ось $Z$. Сравнение эксперимента с обратной связью и без обратной связи.\label{feedback_line}}
\end{figure}

Сравним среднее отклонение проекции вектора $e_3$ от 1 для трех экспериментов с обратной связью  и без нее, расчитанное по уравнению (\ref{sigma}). Для экспериментов с обратной связью $\left<\sigma\right>_{av}=0.025$, а для экспериментов без обратной связи $\left<\sigma\right>_{av}=0.078$. Это показывает, что движение с обратной связью более устойчивое, чем без нее.


%В экспериментах на последнем видео $\tilde{k_{\vartheta}}=100$. По идее от него должна зависеть линейная скорость, но она зависит еще от чего-то, может от заряда батареи, может еще от чего. В разные дни старался выбирать этот коэффициент таким, чтобы двигаться с одной скоростью (на глаз), он был равен от 60 до 100. $\dot{\vartheta}$ -- это угловая скорость тележки. Ее я считаю с энкодера одного из колес, перевожу в рад/с и умножаю на коэффициент $\frac{R_{wheel}}{R_{sphero\_internal}}=\frac{18}{145}=0.124138$, и в формуле беру ее со знаком минус. Выражение $\frac{v^*}{R_S}$ заменяю одним числом, в экспериментах на видео оно было равно 10. В итоге в моей программе уравнение момента принимает следующий вид:

%\begin{equation}
%K_{\vartheta} = \tilde{k_{\vartheta}}(-\dot{\vartheta} + v^*)=100(-\dot{\vartheta}+10),
%\label{torque_wheels_code}
%\end{equation}

%При расчете момента ротора второе уравнение (\ref{torque_wheels}) принимает вид:

%\begin{equation}
%K_{\varphi} = \tilde{k_{\varphi}}(\omega_2 - \dot{\vartheta} + \omega_3 - 0.1*\dot{\varphi}).
%\label{torque_wheels_code}
%\end{equation}

%Здесь я ввел еще один коэффициент 0.1 перед угловой скоростью ротора, так как она давала намного больший вклад. Здесь $\tilde{k_{\varphi}}=200$, $\omega_2$ и $\omega_3$ это компоненты  угловой скорости измеренные с помощью MPU9250 по соответсвующим осям: $\omega_2$ -- угловая скорость относительно оси, вдоль которой производится движение, $\omega_3$ -- угловая скорость относительно оси $Z$. $\dot{\vartheta}$ -- это угловая скорость колеса, считается по энкодеру и переводится в рад/с. Аналогично $\dot{\varphi}$ -- угловая скорость ротора, считается по энкодеру и переводится в рад/с. Угловую скорость колес $\dot{\vartheta}$ я не учитываю, так как это приводит к равномерному вращению ротора, поэтому в расчете момента $K_{\varphi}$ значение $\dot{\vartheta}=0$.

%Далее полученные моменты без коэффициентов устанавливают заданный ток на каждый двигатель. К этому значению тока двигатель выходит с помощью П регулятора. На регуляторах и колес, и ротора пропорциональный коэффициент равен 0.01, коэффициенты дифференциальной и интегральной составляющих равны 0.

%Измерения тока проводятся с частотой 20 КГц, для каждого двигателя берется среднее значение из 50 измерений. Далее это значение тока подается на вход соответствующего П регулятора, на выходе получаем изменение скважности ШИМ сигнала. Таки образом регулятор работает на частоте 400 Гц. Обновление заданого момента на двигателях происходит с частотой 50 Гц.

\begin{thebibliography}{99}

\bibitem{OmniwheelSphero}
Karavaev Y. L., Kilin A. A., The Dynamics and Control of a Spherical Robot with an Internal Omniwheel Platform, Regular and Chaotic Dynamics, 2015, vol. 20, no. 2, pp. 134-152

\bibitem{ComboSphero}
Килин А. А., Караваев Ю. Л., Экспериментальные исследования динамики сферического робота комбинированного типа, Нелинейная динамика, 2015, т. 11, \No 4, с. 721–734

\bibitem{ComboSpheroTheory}
Kilin A.A., Pivovarova E.N., Ivanova T.B. Spherical robot of combined type: Dynamics and control // Regul. Chaotic Dyn., 2015, vol.20, no.6, pp.716–728.

\bibitem{Pololu}
Pololu Robotics'n'Electronics [Электронный ресурс] // URL: https://www.pololu.com/product/1443/faqs

\end{thebibliography}

\end{document} 